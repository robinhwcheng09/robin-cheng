---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const allProjects = await getCollection('projects', (entry) => {
    return (import.meta.env as any).PROD ? entry.data.draft !== true : true;
})

const sortedProjects = allProjects.sort((a, b) => 
    b.data.year.localeCompare(a.data.year)
);
---

<Layout title="Projects">
    <section class="section">
        <h2>Projects</h2>
        <p class="lead">
        Recent projects focused on streamlining operations, building data systems, 
        and automating workflows.
        </p>
    </section>

    <div class="projects">
        {sortedProjects.map((project) => (
        <article class="project">
            <div class="project-header">
                <h3>{project.data.title}</h3>
                <div class="project-meta">
                    <span>{project.data.year}</span>
                    <span>â€¢</span>
                    <span>{project.data.category}</span>
                </div>
            </div>
            <div class="project-content">
                <p>{project.data.summary}</p>
                <div class="project-details">
                    <h4>Challenge</h4>
                    <p>{project.data.challenge}</p>

                    <h4>Outcome</h4>
                    <p>{project.data.outcome}</p>

                    <div class="tech-stack">
                        {project.data.techStack.map((tech) =>(
                            <span>{tech}</span>
                        ))}
                    </div>
                </div>
            </div>
        </article>
        ))}
    </div>

    <footer class="projects-footer">
        <p>
            Interested in similar projects? <a href="mailto:hello@robincheng.com">Get in touch</a>
        </p>
    </footer>
</Layout>

<style>
    .section {
        margin-bottom: var(--space-xl);
        padding-bottom: var(--space-xl);
        border-bottom: 1px solid var(--color-border);
    }
    
    .lead {
        font-size: 1.25rem;
        line-height: 1.7;
        margin-bottom: 0;
    }
    
    .projects {
        display: flex;
        flex-direction: column;
        gap: var(--space-xl);
        margin-bottom: var(--space-xl);
    }
    
    .project {
        padding-bottom: var(--space-xl);
        border-bottom: 1px solid var(--color-border);
    }
    
    .project:last-child {
        border-bottom: none;
    }
    
    .project-header {
        margin-bottom: var(--space-md);
    }
    
    .project-header h3 {
        margin: 0 0 var(--space-sm) 0;
        font-size: 1.5rem;
    }
    
    .project-meta {
        font-family: var(--font-heading);
        font-size: 0.9rem;
        color: var(--color-text-muted);
        display: flex;
        gap: var(--space-sm);
    }
    
    .project-content > p {
        margin-bottom: var(--space-lg);
    }
    
    .project-details {
        background: var(--color-surface);
        padding: var(--space-lg);
        border-left: 2px solid var(--color-border);
    }
    
    .project-details h4 {
        font-family: var(--font-heading);
        font-size: 1rem;
        font-weight: 600;
        margin-top: var(--space-lg);
        margin-bottom: var(--space-sm);
    }
    
    .project-details h4:first-child {
        margin-top: 0;
    }
    
    .project-details p {
        margin-bottom: var(--space-md);
    }
    
    .tech-stack {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-sm);
        margin-top: var(--space-lg);
    }
    
    .tech-stack span {
        font-family: var(--font-heading);
        font-size: 0.85rem;
        padding: 0.25rem 0.75rem;
        background: var(--color-bg);
        color: var(--color-text-muted);
        border-radius: 3px;
    }
    
    .work-footer {
        padding-top: var(--space-lg);
        border-top: 1px solid var(--color-border);
        text-align: center;
    }
    
    .work-footer p {
        margin: 0;
        font-size: 1rem;
    }
</style>